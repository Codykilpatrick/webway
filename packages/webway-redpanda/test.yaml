apiVersion: v1
kind: Pod
metadata:
  name: redpanda-quickstart-pod
  labels:
    app: redpanda-quickstart
spec:
  containers:
  # Redpanda broker
  - name: redpanda-0
    image: docker.redpanda.com/redpandadata/redpanda:v25.1.5
    command:
    - redpanda
    - start
    - --kafka-addr
    - internal://0.0.0.0:9092,external://0.0.0.0:19092
    - --advertise-kafka-addr
    - internal://redpanda-0:9092,external://localhost:19092
    - --pandaproxy-addr
    - internal://0.0.0.0:8082,external://0.0.0.0:18082
    - --advertise-pandaproxy-addr
    - internal://redpanda-0:8082,external://localhost:18082
    - --schema-registry-addr
    - internal://0.0.0.0:8081,external://0.0.0.0:18081
    - --rpc-addr
    - redpanda-0:33145
    - --advertise-rpc-addr
    - redpanda-0:33145
    - --mode
    - dev-container
    - --smp
    - "1"
    - --default-log-level=info
    - --set
    - kafka_batch_max_bytes=10485760
    ports:
    - containerPort: 18081
      hostPort: 18081
    - containerPort: 18082
      hostPort: 18082
    - containerPort: 19092
      hostPort: 19092
    - containerPort: 9644
      hostPort: 19644
    volumeMounts:
    - name: redpanda-data
      mountPath: /var/lib/redpanda/data

  # Redpanda Console
  - name: console
    image: docker.redpanda.com/redpandadata/console:v3.1.1
    command: ["/bin/sh"]
    args: 
    - -c
    - 'echo "$$CONSOLE_CONFIG_FILE" > /tmp/config.yml; /app/console'
    ports:
    - containerPort: 8080
      hostPort: 8080
    env:
    - name: CONFIG_FILEPATH
      value: /tmp/config.yml
    - name: CONSOLE_CONFIG_FILE
      value: |
        kafka:
          brokers: ["localhost:9092"]
        schemaRegistry:
          enabled: true
          urls: ["http://localhost:8081"]
        redpanda:
          adminApi:
            enabled: true
            urls: ["http://localhost:9644"]

  volumes:
  - name: redpanda-data
    hostPath:
      path: /tmp/redpanda-data
      type: DirectoryOrCreate